# 動作確認手順

## 前提条件

- 開発サーバーが`http://localhost:3000`で起動している
- ngrok/localtunnel が起動し、エンドポイント URL が取得されている
- LINE Developers コンソールのエンドポイント URL が設定されている
- `.env.local`に LIFF ID が設定されている

## 1. LINE アプリからのアクセス

### 方法 1: LIFF URL を直接開く

1. **スマホの LINE アプリを開く**
2. **ブラウザで以下の URL を開く**:
   ```
   https://miniapp.line.me/YOUR_LIFF_ID
   ```
   例: `https://miniapp.line.me/1234567890-XXXXXXXX`
3. **LINE アプリが開き、アプリが表示されます**

### 方法 2: 開発用チャネルからアクセス

1. **スマホの LINE アプリを開く**
2. **開発用チャネル（公式アカウント）を開く**
3. **リッチメニューやメニューから「ガチャ」を選択**
4. **アプリが表示されます**

## 2. 動作確認項目

### 初期表示

- [ ] LIFF 初期化が成功するか
- [ ] エラーメッセージが表示されないか
- [ ] ユーザー情報（名前、プロフィール画像）が表示されるか
- [ ] 「ガチャ」ボタンが表示されるか

### ガチャモーダル

- [ ] 「ガチャ」ボタンを押すと全画面モーダルが開くか
- [ ] 左側にメニュー（通常ガチャ、プレミアムガチャ）が表示されるか
- [ ] 右側にガチャ情報と「ガチャを引く」ボタンが表示されるか
- [ ] 「閉じる」ボタンでモーダルが閉じるか

### ガチャ抽選

- [ ] 「ガチャを引く」ボタンを押すと動画が再生されるか
- [ ] 動画が全画面で表示されるか
- [ ] 動画再生後に結果が表示されるか
- [ ] レアリティ（コモン、レア、エピック）が正しく表示されるか
- [ ] アイテム名が表示されるか

### 動画再生

- [ ] 動画が自動再生されるか
- [ ] 動画がスムーズに再生されるか
- [ ] 動画終了後に結果画面に遷移するか
- [ ] 結果画面の「閉じる」ボタンでモーダルが閉じるか

### ガチャ種類の切り替え

- [ ] 左側メニューでガチャ種類を選択できるか
- [ ] 選択中のガチャがハイライトされるか
- [ ] 右側のコンテンツが正しく更新されるか

## 3. トラブルシューティング

### LIFF ID が設定されていないエラー

**症状**: 「LIFF ID が設定されていません」というエラーが表示される

**対処法**:

1. `.env.local`ファイルを確認
2. `NEXT_PUBLIC_LIFF_ID`が正しく設定されているか確認
3. 開発サーバーを再起動

```env
NEXT_PUBLIC_LIFF_ID=YOUR_LIFF_ID
```

### 動画が再生されない

**症状**: 動画が再生されない、またはエラーが表示される

**対処法**:

1. `public/videos/item1.mp4`が存在するか確認
2. ブラウザのコンソールでエラーを確認
3. 動画ファイルの形式が正しいか確認（MP4 形式推奨）
4. 動画ファイルのサイズが大きすぎないか確認

### エンドポイント URL にアクセスできない

**症状**: LINE アプリからアクセスできない、またはエラーが表示される

**対処法**:

1. ngrok/localtunnel が起動しているか確認
2. 開発サーバーが`localhost:3000`で起動しているか確認
3. LINE Developers コンソールのエンドポイント URL が正しいか確認
4. ブラウザで直接エンドポイント URL にアクセスして動作確認

### 400 Bad Request エラー

**症状**: 「This channel is now developing status. User need to have developer」というエラー

**対処法**:

1. LINE Developers コンソールでテストユーザーとして自分の LINE アカウントを追加
2. チャネル設定 → ユーザータブ → 「テストユーザーを追加」

### 認証エラー

**症状**: ログインできない、または認証エラーが表示される

**対処法**:

1. LIFF ID が正しいか確認
2. エンドポイント URL が正しく設定されているか確認
3. 開発サーバーが起動しているか確認

## 4. ブラウザでの動作確認

### ローカル環境

1. **ブラウザで`http://localhost:3000`にアクセス**
2. **開発者ツールを開く**（F12）
3. **コンソールタブでエラーを確認**
4. **ネットワークタブで API リクエストを確認**

### 注意事項

- ブラウザでは LIFF SDK が正常に動作しない場合があります
- 実際の動作確認は LINE アプリから行うことを推奨します

## 5. ログの確認

### 開発サーバーのログ

ターミナルで以下のようなログが表示されます：

```
✓ Ready in 12s
○ Compiling /api/gacha ...
✓ Compiled /api/gacha in 234ms
```

### ブラウザのコンソール

開発者ツールのコンソールで以下のようなログが表示されます：

```
LIFF init success
```

## 確認項目チェックリスト

- [ ] 開発サーバーが起動している
- [ ] ngrok/localtunnel が起動している
- [ ] エンドポイント URL が LINE Developers コンソールに設定されている
- [ ] `.env.local`に LIFF ID が設定されている
- [ ] テストユーザーとして自分の LINE アカウントが追加されている
- [ ] LINE アプリからアクセスできる
- [ ] ユーザー情報が表示される
- [ ] ガチャモーダルが開閉できる
- [ ] ガチャ抽選が正常に動作する
- [ ] 動画が再生される
- [ ] 結果が正しく表示される

## 次のステップ

動作確認が完了したら：

- [07_GitHub 設定.md](./07_GitHub設定.md) に進む
- または、追加機能の実装に進む
