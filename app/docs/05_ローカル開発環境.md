# ローカル開発環境セットアップ

## 概要

ローカル開発サーバーをスマホからアクセスできるようにするため、ngrokまたはlocaltunnelを使用してHTTPS URLを取得します。

**推奨**: ngrok（より安定した接続）

## 方法1: ngrokを使用（推奨）

### 1. ngrokアカウント登録

1. **ngrokダッシュボードにアクセス**
   - https://dashboard.ngrok.com/signup にアクセス
   - メールアドレスまたはGitHub/Googleアカウントで登録

2. **メール認証を完了**

### 2. authtokenの取得と設定

1. **authtokenを取得**
   - https://dashboard.ngrok.com/get-started/your-authtoken にアクセス
   - authtokenをコピー

2. **authtokenを設定**
   ```powershell
   ngrok config add-authtoken YOUR_AUTHTOKEN
   ```

### 3. ngrokの実行

1. **開発サーバーを起動**（別のターミナル）:
   ```powershell
   cd "YOUR_PROJECT_PATH\Gacha_Lab\app"
   npm run dev
   ```

2. **ngrokを実行**:
   ```powershell
   ngrok http 3000
   ```

3. **表示されたURLをコピー**:
   ```
   Forwarding  https://xxxxx.ngrok-free.app -> http://localhost:3000
   ```

### 4. LINE DevelopersコンソールでエンドポイントURLを設定

1. LINE Developersコンソールにアクセス
2. チャネル設定 → LIFFタブを開く
3. 開発用LIFFアプリの「編集」をクリック
4. **エンドポイントURL**に`https://xxxxx.ngrok-free.app`を設定
5. 「更新」をクリック

## 方法2: localtunnelを使用（代替）

### 1. localtunnelの実行

```powershell
npx localtunnel --port 3000
```

### 2. 表示されたURLをコピー

```
your url is: https://xxxxx.loca.lt
```

### 3. 注意事項

- **Tunnel Password**: ブラウザでアクセスする場合、パスワードが必要
- **パスワード**: 実行しているPCのパブリックIPアドレス
- **LINEアプリからのアクセス**: パスワード不要（非ブラウザリクエスト）

### 4. トラブルシューティング

- **接続エラー**: ファイアウォールの設定を確認
- **503エラー**: localtunnelサービスの問題（ngrokへの切り替えを推奨）

## 開発フロー

### 1. 開発サーバー起動

```powershell
cd "YOUR_PROJECT_PATH\Gacha_Lab\app"
npm run dev
```

### 2. ngrok/localtunnel起動

**別のターミナル**で実行：

```powershell
# ngrokの場合
ngrok http 3000

# localtunnelの場合
npx localtunnel --port 3000
```

### 3. エンドポイントURLを更新

- ngrok/localtunnelで表示されたURLをコピー
- LINE DevelopersコンソールのエンドポイントURLに設定

### 4. スマホで動作確認

- LINEアプリから開発用チャネルにアクセス
- または、LIFF URLを直接開く

## 注意事項

### ngrok

- ✅ より安定した接続
- ✅ ファイアウォールの問題が少ない
- ✅ パスワード認証が不要
- ✅ 無料プランでも利用可能
- ⚠️ アカウント登録が必要

### localtunnel

- ✅ アカウント登録不要
- ✅ すぐに使用可能
- ⚠️ 接続が不安定な場合がある
- ⚠️ ファイアウォールの問題が発生する可能性
- ⚠️ ブラウザアクセス時にパスワードが必要

## 確認項目

- [ ] ngrokアカウントを登録した（ngrokを使用する場合）
- [ ] authtokenを設定した（ngrokを使用する場合）
- [ ] 開発サーバーが`http://localhost:3000`で起動している
- [ ] ngrok/localtunnelが正常に起動している
- [ ] URLが表示されている
- [ ] LINE DevelopersコンソールのエンドポイントURLが正しく設定されている

## 次のステップ

- [06_動作確認.md](./06_動作確認.md) に進む

