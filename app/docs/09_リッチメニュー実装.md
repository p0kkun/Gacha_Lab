# リッチメニュー実装手順

## 概要

LINE公式アカウントのトーク画面下部に表示されるリッチメニューを実装する手順です。

---

## 1. リッチメニューとは

- LINE公式アカウントのトーク画面下部に表示されるメニュー
- **最大6個のボタンを配置可能**（4個でも可）
- 画像とテキストで視覚的に分かりやすい
- 各ボタンからLIFFアプリの特定機能にアクセス可能

---

## 2. 実装するボタン

以下の4つのボタンを実装します：

1. **A: ガチャ** → ガチャを引く機能
2. **B: マイページ** → ユーザー情報・獲得アイテム確認
3. **C: 抽選履歴** → 過去のガチャ結果確認
4. **F: 友達を招待** → 友達紹介機能

---

## 3. リッチメニュー画像の作成

### 3.1 推奨レイアウト：2行×2列

```
┌─────────┬─────────┐
│  A:ガチャ │ B:マイページ│
├─────────┼─────────┤
│ C:抽選履歴│ F:友達招待 │
└─────────┴─────────┘
```

**画像サイズ：** 2500px × 1686px（通常メニュー）

### 3.2 デザインツール

**推奨ツール：**
- LINE Creative Lab（無料）
- Figma、Photoshop、Canvaなど

**デザインのポイント：**
- 各ボタンエリアを明確に区切る
- アイコンとテキストを配置
- 視認性の高い色を使用（例：ダークグリーン背景に白文字）

**各ボタンの要素：**
- **背景色**: ダークグリーン（#2D5016など）
- **文字色**: 白
- **アイコン**: 各機能を表すアイコン
- **テキスト**: 日本語（上）+ 英語（下）

**例：**
- **ガチャ**: 🎰アイコン + "ガチャ" + "GACHA"
- **マイページ**: 🏠アイコン + "マイページ" + "MY PAGE"
- **抽選履歴**: 📋アイコン + "抽選履歴" + "HISTORY"
- **友達を招待**: 👥アイコン + "友達を招待" + "INVITE FRIENDS"

---

## 4. LINE Official Account Managerでの設定

### 4.1 リッチメニューの作成

1. LINE Official Account Managerにログイン
2. 作成した公式アカウントを選択
3. 「リッチメニュー」→「新規作成」
4. メニュータイプ: **通常メニュー**を選択

### 4.2 画像のアップロード

1. 作成した画像（2500px × 1686px）をアップロード
2. プレビューで表示を確認

### 4.3 アクション設定

#### ボタンA（ガチャ）

- **エリア**: 左上（x: 0, y: 0, width: 1250, height: 843）
- **アクションタイプ**: URIアクション
- **URI**: 
  - 開発用: `https://miniapp.line.me/2008642684-d8jPmggE?action=gacha`
  - 本番用: `https://liff.line.me/2008642684-d8jPmggE?action=gacha`
- **ラベル**: ガチャ

#### ボタンB（マイページ）

- **エリア**: 右上（x: 1250, y: 0, width: 1250, height: 843）
- **アクションタイプ**: URIアクション
- **URI**: 
  - 開発用: `https://miniapp.line.me/2008642684-d8jPmggE?action=mypage`
  - 本番用: `https://liff.line.me/2008642684-d8jPmggE?action=mypage`
- **ラベル**: マイページ

#### ボタンC（抽選履歴）

- **エリア**: 左下（x: 0, y: 843, width: 1250, height: 843）
- **アクションタイプ**: URIアクション
- **URI**: 
  - 開発用: `https://miniapp.line.me/2008642684-d8jPmggE?action=history`
  - 本番用: `https://liff.line.me/2008642684-d8jPmggE?action=history`
- **ラベル**: 抽選履歴

#### ボタンF（友達を招待）

- **エリア**: 右下（x: 1250, y: 843, width: 1250, height: 843）
- **アクションタイプ**: URIアクション
- **URI**: 
  - 開発用: `https://miniapp.line.me/2008642684-d8jPmggE?action=referral`
  - 本番用: `https://liff.line.me/2008642684-d8jPmggE?action=referral`
- **ラベル**: 友達を招待

### 4.4 公開設定

1. 作成したリッチメニューを「公開」に設定
2. 友だち追加したユーザーに表示される

---

## 5. LIFFアプリ側の実装

### 5.1 URLパラメータの処理

`app/page.tsx`でURLパラメータを処理します：

```typescript
'use client';

import { useSearchParams } from 'next/navigation';
import { useEffect, useState } from 'react';

export default function Home() {
  const searchParams = useSearchParams();
  const [activePage, setActivePage] = useState<'home' | 'mypage' | 'history' | 'referral'>('home');

  // URLパラメータからアクションを取得して処理
  useEffect(() => {
    const action = searchParams.get('action');
    
    if (action) {
      switch (action) {
        case 'gacha':
          setIsGachaModalOpen(true);
          setActivePage('home');
          break;
        case 'mypage':
          setActivePage('mypage');
          break;
        case 'history':
          setActivePage('history');
          break;
        case 'referral':
          setActivePage('referral');
          break;
        default:
          setActivePage('home');
      }
    }
  }, [searchParams]);

  // アクティブページに応じたコンテンツを表示
  // ...
}
```

### 5.2 各ページコンポーネントの作成

各機能に対応するページコンポーネントを作成します：

- **マイページ**: ユーザー情報、獲得アイテム一覧
- **抽選履歴**: 過去のガチャ結果一覧
- **友達を招待**: 友達紹介機能

詳細は `app/page.tsx` を参照してください。

---

## 6. LIFF URLについて

### 6.1 開発用URL

```
https://miniapp.line.me/2008642684-d8jPmggE
```

- **ドメイン**: `miniapp.line.me`（開発用）
- **LIFF ID**: `2008642684-d8jPmggE`

### 6.2 本番用URL

```
https://liff.line.me/2008642684-d8jPmggE
```

- **ドメイン**: `liff.line.me`（本番用）
- **LIFF ID**: `2008642684-d8jPmggE`（同じ）

詳細は `LIFF_URL設定.md` を参照してください。

---

## 7. 動作確認

### 7.1 リッチメニューの表示確認

1. LINE公式アカウントを友だち追加
2. トーク画面下部にリッチメニューが表示されることを確認
3. 各ボタンが正しく表示されることを確認

### 7.2 各ボタンの動作確認

1. **ガチャボタン**: LIFFアプリが開き、ガチャモーダルが表示される
2. **マイページボタン**: LIFFアプリが開き、マイページが表示される
3. **抽選履歴ボタン**: LIFFアプリが開き、抽選履歴が表示される
4. **友達を招待ボタン**: LIFFアプリが開き、友達紹介画面が表示される

---

## 確認項目

- [ ] リッチメニュー画像を作成した（2500px × 1686px）
- [ ] LINE Official Account Managerでリッチメニューを作成した
- [ ] 4つのエリアにアクションを設定した
- [ ] LIFFアプリ側でURLパラメータを処理した
- [ ] 各ページコンポーネントを作成した
- [ ] 動作確認を完了した

---

## トラブルシューティング

### リッチメニューが表示されない

- 公式アカウントを友だち追加しているか確認
- リッチメニューが「公開」状態になっているか確認
- 画像サイズが正しいか確認（2500px × 1686px）

### ボタンを押してもアプリが開かない

- URIが正しく設定されているか確認
- LIFF IDが正しいか確認
- 開発用/本番用のURLを正しく使い分けているか確認

### URLパラメータが処理されない

- `useSearchParams()`が正しく使用されているか確認
- `action`パラメータの値が正しいか確認
- ブラウザのコンソールでエラーを確認

---

## 次のステップ

- [10_メッセージ通知実装.md](./10_メッセージ通知実装.md) に進む（今後実装予定）

---

## 参考資料

- [リッチメニュー4個ボタン実装方法.md](../リッチメニュー4個ボタン実装方法.md)
- [LINE公式アカウントにLIFFアプリを表示する方法.md](../LINE公式アカウントにLIFFアプリを表示する方法.md)
- [LIFF_URL設定.md](../LIFF_URL設定.md)
- [LINE Messaging API ドキュメント](https://developers.line.biz/ja/docs/messaging-api/)

