version: 1
applications:
  - appRoot: app
    frontend:
      phases:
        preBuild:
          commands:
            - npm install
            - npm run db:generate
        build:
          commands:
            - npm run build
        postBuild:
          commands:
            # ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¦ã‚©ãƒ¬ãƒƒãƒˆï¼ˆApple Payã€Google Payãªã©ï¼‰ç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è‡ªå‹•ç™»éŒ²ï¼ˆç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿ï¼‰
            - |
              if [ -n "$PAYMENT_METHOD_DOMAIN" ] && [ -n "$STRIPE_SECRET_KEY" ]; then
                echo "ğŸ“ ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¦ã‚©ãƒ¬ãƒƒãƒˆç”¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç™»éŒ²ä¸­: $PAYMENT_METHOD_DOMAIN"
                npx tsx scripts/register-payment-method-domain.ts "$PAYMENT_METHOD_DOMAIN" || echo "âš ï¸  ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸï¼ˆæ—¢ã«ç™»éŒ²æ¸ˆã¿ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼‰"
              else
                echo "â„¹ï¸  PAYMENT_METHOD_DOMAINã¾ãŸã¯STRIPE_SECRET_KEYãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ç™»éŒ²ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™"
              fi
      artifacts:
        baseDirectory: .next
        files:
          - "**/*"
      cache:
        paths:
          - node_modules/**/*
